<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
</head>
<body>
    <div class="header">
        <a href="index.html" class="logo">YourLogo</a>
        <div class="back-btn" onclick="window.location.href='result.html'">←</div>
    </div>
    <div class="main-content">
        <div class="account-section" id="loginSection">
            <h2>Login or Sign Up</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email or Phone Number</label>
                    <input type="text" id="email" name="email" placeholder="Enter email or phone" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="Enter your password" required>
                </div>
                <div class="otp-group" id="otpGroup">
                    <label for="otp">OTP</label>
                    <input type="text" id="otp" name="otp" placeholder="Enter OTP" required>
                    <button type="button" class="otp-btn" onclick="verifyOTP()">Verify OTP</button>
                </div>
                <button type="submit" class="submit-btn">Login</button>
                <a href="#" class="signup-link" onclick="showSignup()">Don’t have an account? Sign Up</a>
                <a href="#" class="forgot-link" onclick="showForgotPassword()">Forgot Password?</a>
            </form>
        </div>
        <div class="account-section" id="signupSection" style="display: none;">
            <h2>Sign Up</h2>
            <form id="signupForm">
                <div class="form-group">
                    <label for="newEmail">Email</label>
                    <input type="email" id="newEmail" name="newEmail" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="newPhone">Phone Number</label>
                    <input type="tel" id="newPhone" name="newPhone" placeholder="+92 1234567890" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">Password</label>
                    <input type="password" id="newPassword" name="newPassword" placeholder="Enter your password" required>
                </div>
                <div class="otp-group" id="signupOtpGroup">
                    <label for="signupOtp">OTP</label>
                    <input type="text" id="signupOtp" name="signupOtp" placeholder="Enter OTP" required>
                    <button type="button" class="otp-btn" onclick="verifySignupOTP()">Verify OTP</button>
                </div>
                <button type="submit" class="submit-btn">Sign Up</button>
                <a href="#" class="login-link" onclick="showLogin()">Already have an account? Login</a>
            </form>
        </div>
        <div class="account-section" id="forgotSection" style="display: none;">
            <h2>Forgot Password</h2>
            <form id="forgotForm">
                <div class="form-group">
                    <label for="forgotEmail">Email or Phone Number</label>
                    <input type="text" id="forgotEmail" name="forgotEmail" placeholder="Enter email or phone" required>
                </div>
                <div class="otp-group" id="forgotOtpGroup">
                    <label for="forgotOtp">OTP</label>
                    <input type="text" id="forgotOtp" name="forgotOtp" placeholder="Enter OTP" required>
                    <button type="button" class="otp-btn" onclick="verifyForgotOTP()">Verify OTP</button>
                </div>
                <button type="submit" class="submit-btn">Reset Password</button>
                <a href="#" class="login-link" onclick="showLogin()">Back to Login</a>
            </form>
        </div>
    </div>

    <script>
        // Your Firebase configuration (replace with your actual config)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Show/Hide Sections
        function showLogin() {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('signupSection').style.display = 'none';
            document.getElementById('forgotSection').style.display = 'none';
        }

        function showSignup() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('signupSection').style.display = 'block';
            document.getElementById('forgotSection').style.display = 'none';
        }

        function showForgotPassword() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('signupSection').style.display = 'none';
            document.getElementById('forgotSection').style.display = 'block';
        }

        // Login with Email/Password or Phone OTP
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const emailOrPhone = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (isPhoneNumber(emailOrPhone)) {
                sendPhoneOTP(emailOrPhone, 'login');
            } else {
                auth.signInWithEmailAndPassword(emailOrPhone, password)
                    .then((userCredential) => {
                        alert('Logged in successfully!');
                        window.location.href = 'result.html';
                    })
                    .catch((error) => {
                        alert('Login failed: ' + error.message);
                    });
            }
        });

        // Sign Up with Email/Password and Phone OTP
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('newEmail').value;
            const phone = document.getElementById('newPhone').value;
            const password = document.getElementById('newPassword').value;

            sendPhoneOTP(phone, 'signup');
        });

        // Forgot Password with Email/OTP
        document.getElementById('forgotForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const emailOrPhone = document.getElementById('forgotEmail').value;

            if (isPhoneNumber(emailOrPhone)) {
                sendPhoneOTP(emailOrPhone, 'forgot');
            } else {
                auth.sendPasswordResetEmail(emailOrPhone)
                    .then(() => {
                        alert('Password reset email sent! Check your inbox.');
                        showLogin();
                    })
                    .catch((error) => {
                        alert('Error sending reset email: ' + error.message);
                    });
            }
        });

        // Helper function to check if input is a phone number
        function isPhoneNumber(value) {
            return /^\+?[1-9]\d{1,14}$/.test(value);
        }

        // Send OTP for Phone Number
        let verificationId = null;
        function sendPhoneOTP(phone, context) {
            const recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                'size': 'invisible'
            });
            auth.signInWithPhoneNumber(phone, recaptchaVerifier)
                .then((confirmationResult) => {
                    verificationId = confirmationResult.verificationId;
                    alert('OTP sent to ' + phone + '! Enter the code below.');
                    if (context === 'login') {
                        document.getElementById('otpGroup').style.display = 'block';
                    } else if (context === 'signup') {
                        document.getElementById('signupOtpGroup').style.display = 'block';
                    } else if (context === 'forgot') {
                        document.getElementById('forgotOtpGroup').style.display = 'block';
                    }
                })
                .catch((error) => {
                    alert('Error sending OTP: ' + error.message);
                });
        }

        // Verify OTP for Login
        function verifyOTP() {
            const otp = document.getElementById('otp').value;
            const credential = firebase.auth.PhoneAuthProvider.credential(verificationId, otp);
            auth.signInWithCredential(credential)
                .then((userCredential) => {
                    alert('OTP verified, logged in successfully!');
                    window.location.href = 'result.html';
                })
                .catch((error) => {
                    alert('Invalid OTP: ' + error.message);
                });
        }

        // Verify OTP for Sign Up
        function verifySignupOTP() {
            const otp = document.getElementById('signupOtp').value;
            const credential = firebase.auth.PhoneAuthProvider.credential(verificationId, otp);
            auth.signInWithCredential(credential)
                .then((userCredential) => {
                    const email = document.getElementById('newEmail').value;
                    const password = document.getElementById('newPassword').value;
                    auth.createUserWithEmailAndPassword(email, password)
                        .then(() => {
                            alert('Account created and verified successfully!');
                            window.location.href = 'result.html';
                        })
                        .catch((error) => {
                            alert('Error creating account: ' + error.message);
                        });
                })
                .catch((error) => {
                    alert('Invalid OTP: ' + error.message);
                });
        }

        // Verify OTP for Forgot Password
        function verifyForgotOTP() {
            const otp = document.getElementById('forgotOtp').value;
            const phone = document.getElementById('forgotEmail').value;
            const credential = firebase.auth.PhoneAuthProvider.credential(verificationId, otp);
            auth.signInWithCredential(credential)
                .then((userCredential) => {
                    alert('OTP verified! Redirecting to reset password.');
                    // For demo, redirect back to login (you can add password reset logic here)
                    showLogin();
                })
                .catch((error) => {
                    alert('Invalid OTP: ' + error.message);
                });
        }

        // Add recaptcha container (invisible)
        document.write('<div id="recaptcha-container"></div>');
    </script>
</body>
</html>
